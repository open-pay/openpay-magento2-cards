(function(){var c=function(){};var e=function(){};var g=function(){};c._hostname="https://api.openpay.mx/";c._sandboxHostname="https://sandbox-api.openpay.mx/";c._developHostname="https://dev-api.openpay.mx/";c._deviceDataId=undefined;function f(){if(c._deviceDataId===undefined){c._deviceDataId=b.codec.base64.fromBits(b.random.randomWords(6,0)).replace(/[\+\/]/g,"0")}return c._deviceDataId}function a(i,k,l){var j=i+"antifraud/"+k+"/components?s="+l;if(window.XDomainRequest){var h=new XDomainRequest();h.open("GET",j);h.onload=function(){document.body.insertAdjacentHTML("beforeend",h.responseText)};setTimeout(function(){h.send()},0)}else{xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){document.body.insertAdjacentHTML("beforeend",xmlhttp.responseText)}};xmlhttp.open("GET",j,true);xmlhttp.send()}}function d(){var h;var j=f();if(OpenPay.developMode){h=c._developHostname}else{if(OpenPay.sandboxMode){h=c._sandboxHostname}else{h=c._hostname}}var i=OpenPay.getId();a(h,i,j);return f()}c.setup=function(i,q){var k=f();if(i&&document.getElementById(i)){var p=document.createElement("input");p.setAttribute("type","hidden");p.value=k;p.name=q?q:"deviceDataId";p.id=q?q:"deviceDataId";document.getElementById(i).appendChild(p)}var o=true;try{OpenPay.getId();OpenPay.getApiKey()}catch(m){o=false}if(o){console.log("executing sift mode");var j=OpenPay.getId();var l=OpenPay.getApiKey();var n;if(OpenPay.developMode){n=c._developHostname}else{if(OpenPay.sandboxMode){n=c._sandboxHostname}else{n=c._hostname}}var h=n+"v1/"+j+"/antifraudkeys";try{OpenPay.getBeaconKey.beaconKey(h,l,"",k,n)}catch(m){console.log("continue without beaconkey"+m)}}return d()};g.beaconKey=function(o,h,l,x,t){var m=null,i=null,q=o,u={},A=0,j=btoa(h+":");var w={};function r(B,D,F){clearTimeout(i);var C=null;B=B||"Unknown error";D=D||0;F=F||"{}";try{C=JSON.parse(F)}catch(E){B="Response error"}}if(typeof JSON==="undefined"){r("Browser error (JSON library not found)");return}A=40000;var p=XMLHttpRequest&&("withCredentials" in new XMLHttpRequest());if(!p){if(typeof XDomainRequest!=="undefined"){w.apiKey=j;var z=function(C){if(C.error){r("Request error",C.httpStatus,JSON.stringify(C))}else{try{var B=C.data;console.log("beaconKey ok");if(B.length>0){OpenPay.deviceDataSC.setupSC(l,x,B,t)}else{console.log("Empty beaconKey normal in Sandbox")}}catch(D){r("Response error (Unknown final status)",m.status,"{}")}}};var n={callbackName:"getResultData",onSuccess:z,onError:r,timeout:A,url:q+"/jsonp",data:w};$jsonp.send(n)}else{r("Browser error (CORS not supported)");return}}else{function y(){if(s(window,"XMLHttpRequest")){return new XMLHttpRequest()}}function s(B,D){var C=typeof B[D];return C=="function"||(!!(C=="object"&&B[D]))||C=="unknown"}function v(){if(typeof m.readyState!=="undefined"&&m.readyState==4||!p){clearTimeout(i);if(m.status<200||m.status>=300){r("Request error NO IE",m.status,m.responseText)}else{try{var C=m.responseText;C=C.replace("(","");C=C.replace(")","");var D=JSON.parse(C);var B=D.data;console.log("beaconKey ok");if(B.length>0){OpenPay.deviceDataSC.setupSC(l,x,B,t)}else{console.log("Empty beaconKey normal in Sandbox")}}catch(E){r("Response error (Unknown final status) NO IE",m.status,"{}")}}}}if(!(m=y())){r("Browser error (CORS not supported)");return}u={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+j};m.open("GET",q,true);if("withCredentials" in m){m.withCredentials=true}for(var k in u){if(u.hasOwnProperty(k)&&u[k]){if("setRequestHeader" in m){m.setRequestHeader(k,u[k])}}}if("onreadystatechange" in m){m.onreadystatechange=v}else{if("onload" in m&&"onerror" in m){m.onload=v;m.onerror=r}}i=setTimeout(function(){if("onload" in m){m.onload=Function.prototype}else{m.onreadystatechange=Function.prototype}m.abort();m=null;r("Timeout after "+A+" milliseconds")},A);m.send()}};e.setupSC=function(k,n,h,j){console.log("Sift Snippet");var i=window._sift=window._sift||[];i.push(["_setAccount",h]);i.push(["_setSessionId",n]);i.push(["_trackPageview"]);var m=document.createElement("script");m.type="text/javascript";m.async=true;m.src=j+"antifraud/sc.js";var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(m,l)};OpenPay.deviceData=c;OpenPay.getBeaconKey=g;OpenPay.deviceDataSC=e;var b={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(h){this.toString=function(){return"CORRUPT: "+this.message};this.message=h},invalid:function(h){this.toString=function(){return"INVALID: "+this.message};this.message=h},bug:function(h){this.toString=function(){return"BUG: "+this.message};this.message=h},notReady:function(h){this.toString=function(){return"NOT READY: "+this.message};this.message=h}}};if(typeof module!=="undefined"&&module.exports){module.exports=b}b.cipher.aes=function(q){if(!this._tables[0][0][0]){this._precompute()}var m,l,n,p,s,o=this._tables[0][4],r=this._tables[1],h=q.length,k=1;if(h!==4&&h!==6&&h!==8){throw new b.exception.invalid("invalid aes key size")}this._key=[p=q.slice(0),s=[]];for(m=h;m<4*h+28;m++){n=p[m-1];if(m%h===0||h===8&&m%h===4){n=o[n>>>24]<<24^o[n>>16&255]<<16^o[n>>8&255]<<8^o[n&255];if(m%h===0){n=n<<8^n>>>24^k<<24;k=k<<1^(k>>7)*283}}p[m]=p[m-h]^n}for(l=0;m;l++,m--){n=p[l&3?m:m-4];if(m<=4||l<4){s[l]=n}else{s[l]=r[0][o[n>>>24]]^r[1][o[n>>16&255]]^r[2][o[n>>8&255]]^r[3][o[n&255]]}}};b.cipher.aes.prototype={encrypt:function(h){return this._crypt(h,0)},decrypt:function(h){return this._crypt(h,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var p=this._tables[0],y=this._tables[1],o=p[4],u=y[4],n,r,m,q=[],k=[],j,w,t,v,l,h;for(n=0;n<256;n++){k[(q[n]=n<<1^(n>>7)*283)^n]=n}for(r=m=0;!o[r];r^=j||1,m=k[m]||1){v=m^m<<1^m<<2^m<<3^m<<4;v=v>>8^v&255^99;o[r]=v;u[v]=r;t=q[w=q[j=q[r]]];h=t*16843009^w*65537^j*257^r*16843008;l=q[v]*257^v*16843008;for(n=0;n<4;n++){p[n][r]=l=l<<24^l>>>8;y[n][v]=h=h<<24^h>>>8}}for(n=0;n<5;n++){p[n]=p[n].slice(0);y[n]=y[n].slice(0)}},_crypt:function(n,q){if(n.length!==4){throw new b.exception.invalid("invalid aes block size")}var B=this._key[q],y=n[0]^B[0],x=n[q?3:1]^B[1],w=n[2]^B[2],v=n[q?1:3]^B[3],z,h,p,A=B.length/4-2,s,r=4,t=[0,0,0,0],u=this._tables[q],m=u[0],l=u[1],k=u[2],j=u[3],o=u[4];for(s=0;s<A;s++){z=m[y>>>24]^l[x>>16&255]^k[w>>8&255]^j[v&255]^B[r];h=m[x>>>24]^l[w>>16&255]^k[v>>8&255]^j[y&255]^B[r+1];p=m[w>>>24]^l[v>>16&255]^k[y>>8&255]^j[x&255]^B[r+2];v=m[v>>>24]^l[y>>16&255]^k[x>>8&255]^j[w&255]^B[r+3];r+=4;y=z;x=h;w=p}for(s=0;s<4;s++){t[q?3&-s:s]=o[y>>>24]<<24^o[x>>16&255]<<16^o[w>>8&255]<<8^o[v&255]^B[r++];z=y;y=x;x=w;w=v;v=z}return t}};b.bitArray={bitSlice:function(h,i,j){h=b.bitArray._shiftRight(h.slice(i/32),32-(i&31)).slice(1);return j===undefined?h:b.bitArray.clamp(h,j-i)},extract:function(i,j,l){var h,k=Math.floor(-j-l&31);if((j+l-1^j)&-32){h=i[j/32|0]<<32-k^i[j/32+1|0]>>>k}else{h=i[j/32|0]>>>k}return h&(1<<l)-1},concat:function(k,h){if(k.length===0||h.length===0){return k.concat(h)}var l,m,n=k[k.length-1],j=b.bitArray.getPartial(n);if(j===32){return k.concat(h)}else{return b.bitArray._shiftRight(h,j,n|0,k.slice(0,k.length-1))}},bitLength:function(j){var i=j.length,h;if(i===0){return 0}h=j[i-1];return(i-1)*32+b.bitArray.getPartial(h)},clamp:function(j,h){if(j.length*32<h){return j}j=j.slice(0,Math.ceil(h/32));var i=j.length;h=h&31;if(i>0&&h){j[i-1]=b.bitArray.partial(h,j[i-1]&2147483648>>h-1,1)}return j},partial:function(i,h,j){if(i===32){return h}return(j?h|0:h<<32-i)+i*1099511627776},getPartial:function(h){return Math.round(h/1099511627776)||32},equal:function(k,j){if(b.bitArray.bitLength(k)!==b.bitArray.bitLength(j)){return false}var h=0,l;for(l=0;l<k.length;l++){h|=k[l]^j[l]}return h===0},_shiftRight:function(k,j,o,m){var n,h=0,l;if(m===undefined){m=[]}for(;j>=32;j-=32){m.push(o);o=0}if(j===0){return m.concat(k)}for(n=0;n<k.length;n++){m.push(o|k[n]>>>j);o=k[n]<<32-j}h=k.length?k[k.length-1]:0;l=b.bitArray.getPartial(h);m.push(b.bitArray.partial(j+l&31,j+l>32?o:m.pop(),1));return m},_xor4:function(h,i){return[h[0]^i[0],h[1]^i[1],h[2]^i[2],h[3]^i[3]]}};b.codec.utf8String={fromBits:function(h){var j="",m=b.bitArray.bitLength(h),l,k;for(l=0;l<m/8;l++){if((l&3)===0){k=h[l/4]}j+=String.fromCharCode(k>>>24);k<<=8}return decodeURIComponent(escape(j))},toBits:function(l){l=unescape(encodeURIComponent(l));var h=[],k,j=0;for(k=0;k<l.length;k++){j=j<<8|l.charCodeAt(k);if((k&3)===3){h.push(j);j=0}}if(k&3){h.push(b.bitArray.partial(8*(k&3),j))}return h}};b.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(n,q,j){var k="",l,p=0,o=b.codec.base64._chars,m=0,h=b.bitArray.bitLength(n);if(j){o=o.substr(0,62)+"-_"}for(l=0;k.length*6<h;){k+=o.charAt((m^n[l]>>>p)>>>26);if(p<6){m=n[l]<<6-p;p+=26;l++}else{m<<=6;p-=6}}while(k.length&3&&!q){k+="="}return k},toBits:function(o,m){o=o.replace(/\s|=/g,"");var k=[],l,n=0,p=b.codec.base64._chars,j=0,h;if(m){p=p.substr(0,62)+"-_"}for(l=0;l<o.length;l++){h=p.indexOf(o.charAt(l));if(h<0){throw new b.exception.invalid("this isn't base64!")}if(n>26){n-=26;k.push(j^h>>>n);j=h<<32-n}else{n+=6;j^=h<<32-n}}if(n&56){k.push(b.bitArray.partial(n&56,j,1))}return k}};b.codec.base64url={fromBits:function(h){return b.codec.base64.fromBits(h,1,1)},toBits:function(h){return b.codec.base64.toBits(h,1)}};b.hash.sha256=function(h){if(!this._key[0]){this._precompute()}if(h){this._h=h._h.slice(0);this._buffer=h._buffer.slice(0);this._length=h._length}else{this.reset()}};b.hash.sha256.hash=function(h){return(new b.hash.sha256).update(h).finalize()};b.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(m){if(typeof m==="string"){m=b.codec.utf8String.toBits(m)}var l,h=this._buffer=b.bitArray.concat(this._buffer,m),k=this._length,j=this._length=k+b.bitArray.bitLength(m);for(l=512+k&-512;l<=j;l+=512){this._block(h.splice(0,16))}return this},finalize:function(){var k,j=this._buffer,l=this._h;j=b.bitArray.concat(j,[b.bitArray.partial(1,1)]);for(k=j.length+2;k&15;k++){j.push(0)}j.push(Math.floor(this._length/4294967296));j.push(this._length|0);while(j.length){this._block(j.splice(0,16))}this.reset();return l},_init:[],_key:[],_precompute:function(){var l=0,k=2,j;function h(i){return(i-Math.floor(i))*4294967296|0}outer:for(;l<64;k++){for(j=2;j*j<=k;j++){if(k%j===0){continue outer}}if(l<8){this._init[l]=h(Math.pow(k,1/2))}this._key[l]=h(Math.pow(k,1/3));l++}},_block:function(v){var m,n,z,y,A=v.slice(0),p=this._h,j=this._key,x=p[0],u=p[1],t=p[2],s=p[3],r=p[4],q=p[5],o=p[6],l=p[7];for(m=0;m<64;m++){if(m<16){n=A[m]}else{z=A[m+1&15];y=A[m+14&15];n=A[m&15]=(z>>>7^z>>>18^z>>>3^z<<25^z<<14)+(y>>>17^y>>>19^y>>>10^y<<15^y<<13)+A[m&15]+A[m+9&15]|0}n=n+l+(r>>>6^r>>>11^r>>>25^r<<26^r<<21^r<<7)+(o^r&(q^o))+j[m];l=o;o=q;q=r;r=s+n|0;s=t;t=u;u=x;x=n+(u&t^s&(u^t))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10)|0}p[0]=p[0]+x|0;p[1]=p[1]+u|0;p[2]=p[2]+t|0;p[3]=p[3]+s|0;p[4]=p[4]+r|0;p[5]=p[5]+q|0;p[6]=p[6]+o|0;p[7]=p[7]+l|0}};b.prng=function(h){this._pools=[new b.hash.sha256];this._poolEntropy=[0];this._reseedCount=0;this._robins={};this._eventId=0;this._collectorIds={};this._collectorIdNext=0;this._strength=0;this._poolStrength=0;this._nextReseed=0;this._key=[0,0,0,0,0,0,0,0];this._counter=[0,0,0,0];this._cipher=undefined;this._defaultParanoia=h;this._collectorsStarted=false;this._callbacks={progress:{},seeded:{}};this._callbackI=0;this._NOT_READY=0;this._READY=1;this._REQUIRES_RESEED=2;this._MAX_WORDS_PER_BURST=65536;this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024];this._MILLISECONDS_PER_RESEED=30000;this._BITS_PER_RESEED=80};b.prng.prototype={randomWords:function(h,n){var j=[],l,k=this.isReady(n),m;if(k===this._NOT_READY){throw new b.exception.notReady("generator isn't seeded")}else{if(k&this._REQUIRES_RESEED){this._reseedFromPools(!(k&this._READY))}}for(l=0;l<h;l+=4){if((l+1)%this._MAX_WORDS_PER_BURST===0){this._gate()}m=this._gen4words();j.push(m[0],m[1],m[2],m[3])}this._gate();return j.slice(0,h)},setDefaultParanoia:function(i,h){if(i===0&&h!=="Setting paranoia=0 will ruin your security; use it only for testing"){throw"Setting paranoia=0 will ruin your security; use it only for testing"}this._defaultParanoia=i},addEntropy:function(m,s,h){h=h||"user";var j,n,o,q=(new Date).valueOf(),k=this._robins[h],r=this.isReady(),l=0,p;j=this._collectorIds[h];if(j===undefined){j=this._collectorIds[h]=this._collectorIdNext++}if(k===undefined){k=this._robins[h]=0}this._robins[h]=(this._robins[h]+1)%this._pools.length;switch(typeof m){case"number":if(s===undefined){s=1}this._pools[k].update([j,this._eventId++,1,s,q,1,m|0]);break;case"object":p=Object.prototype.toString.call(m);if(p==="[object Uint32Array]"){o=[];for(n=0;n<m.length;n++){o.push(m[n])}m=o}else{if(p!=="[object Array]"){l=1}for(n=0;n<m.length&&!l;n++){if(typeof m[n]!=="number"){l=1}}}if(!l){if(s===undefined){s=0;for(n=0;n<m.length;n++){o=m[n];while(o>0){s++;o=o>>>1}}}this._pools[k].update([j,this._eventId++,2,s,q,m.length].concat(m))}break;case"string":if(s===undefined){s=m.length}this._pools[k].update([j,this._eventId++,3,s,q,m.length]);this._pools[k].update(m);break;default:l=1}if(l){throw new b.exception.bug("random: addEntropy only supports number, array of numbers or string")}this._poolEntropy[k]+=s;this._poolStrength+=s;if(r===this._NOT_READY){if(this.isReady()!==this._NOT_READY){this._fireEvent("seeded",Math.max(this._strength,this._poolStrength))}this._fireEvent("progress",this.getProgress())}},isReady:function(i){var h=this._PARANOIA_LEVELS[i!==undefined?i:this._defaultParanoia];if(this._strength&&this._strength>=h){return this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY}else{return this._poolStrength>=h?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY}},getProgress:function(i){var h=this._PARANOIA_LEVELS[i?i:this._defaultParanoia];if(this._strength>=h){return 1}else{return this._poolStrength>h?1:this._poolStrength/h}},startCollectors:function(){if(this._collectorsStarted){return}this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector)};if(window.addEventListener){window.addEventListener("load",this._eventListener.loadTimeCollector,false);window.addEventListener("mousemove",this._eventListener.mouseCollector,false);window.addEventListener("keypress",this._eventListener.keyboardCollector,false);window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,false)}else{if(document.attachEvent){document.attachEvent("onload",this._eventListener.loadTimeCollector);document.attachEvent("onmousemove",this._eventListener.mouseCollector);document.attachEvent("keypress",this._eventListener.keyboardCollector)}else{throw new b.exception.bug("can't attach event")}}this._collectorsStarted=true},stopCollectors:function(){if(!this._collectorsStarted){return}if(window.removeEventListener){window.removeEventListener("load",this._eventListener.loadTimeCollector,false);window.removeEventListener("mousemove",this._eventListener.mouseCollector,false);window.removeEventListener("keypress",this._eventListener.keyboardCollector,false);window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,false)}else{if(document.detachEvent){document.detachEvent("onload",this._eventListener.loadTimeCollector);document.detachEvent("onmousemove",this._eventListener.mouseCollector);document.detachEvent("keypress",this._eventListener.keyboardCollector)}}this._collectorsStarted=false},addEventListener:function(h,i){this._callbacks[h][this._callbackI++]=i},removeEventListener:function(n,h){var o,m,l=this._callbacks[n],k=[];for(m in l){if(l.hasOwnProperty(m)&&l[m]===h){k.push(m)}}for(o=0;o<k.length;o++){m=k[o];delete l[m]}},_bind:function(i){var h=this;return function(){i.apply(h,arguments)}},_gen4words:function(){for(var h=0;h<4;h++){this._counter[h]=this._counter[h]+1|0;if(this._counter[h]){break}}return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new b.cipher.aes(this._key)},_reseed:function(j){this._key=b.hash.sha256.hash(this._key.concat(j));this._cipher=new b.cipher.aes(this._key);for(var h=0;h<4;h++){this._counter[h]=this._counter[h]+1|0;if(this._counter[h]){break}}},_reseedFromPools:function(k){var h=[],l=0,j;this._nextReseed=h[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(j=0;j<16;j++){h.push(Math.random()*4294967296|0)}for(j=0;j<this._pools.length;j++){h=h.concat(this._pools[j].finalize());l+=this._poolEntropy[j];this._poolEntropy[j]=0;if(!k&&this._reseedCount&1<<j){break}}if(this._reseedCount>=1<<this._pools.length){this._pools.push(new b.hash.sha256);this._poolEntropy.push(0)}this._poolStrength-=l;if(l>this._strength){this._strength=l}this._reseedCount++;this._reseed(h)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(i){var h=i.x||i.clientX||i.offsetX||0,j=i.y||i.clientY||i.offsetY||0;b.random.addEntropy([h,j],2,"mouse");this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(h){if(window&&window.performance&&typeof window.performance.now==="function"){b.random.addEntropy(window.performance.now(),h,"loadtime")}else{b.random.addEntropy((new Date).valueOf(),h,"loadtime")}},_accelerometerCollector:function(i){var h=i.accelerationIncludingGravity.x||i.accelerationIncludingGravity.y||i.accelerationIncludingGravity.z;if(window.orientation){var j=window.orientation;if(typeof j==="number"){b.random.addEntropy(j,1,"accelerometer")}}if(h){b.random.addEntropy(h,2,"accelerometer")}this._addCurrentTimeToEntropy(0)},_fireEvent:function(l,h){var k,i=b.random._callbacks[l],m=[];for(k in i){if(i.hasOwnProperty(k)){m.push(i[k])}}for(k=0;k<m.length;k++){m[k](h)}}};b.random=new b.prng(6);(function(){try{var i,k,h,j;if(typeof module!=="undefined"&&module.exports&&(k=require("crypto"))&&k.randomBytes){i=k.randomBytes(1024/8);i=new Uint32Array((new Uint8Array(i)).buffer);b.random.addEntropy(i,1024,"crypto.randomBytes")}else{if(window&&Uint32Array){j=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues){window.crypto.getRandomValues(j)}else{if(window.msCrypto&&window.msCrypto.getRandomValues){window.msCrypto.getRandomValues(j)}else{return}}b.random.addEntropy(j,1024,"crypto.getRandomValues")}else{}}}catch(l){console.log("There was an error collecting entropy from the browser:");console.log(l)}})()}).call(this);
